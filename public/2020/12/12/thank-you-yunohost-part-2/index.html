<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Thank you Yunohost (Part 2) | Lopeztel&#39;s Blog</title>
<meta name="keywords" content="100DaysToOffload, Selfhosting, yunohost">
<meta name="description" content="This is a bit of a continuation on my previous thank you post, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:
First things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a yunohost server on my raspberry pi 4 for months now.">
<meta name="author" content="lopeztel">
<link rel="canonical" href="https://lopeztel.xyz/blog/2020/12/12/thank-you-yunohost-part-2/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.b183800e2cfbb62c3bce2b2ba56cdb2dd33af76c75cf4550173d5dfebd7c68a6.css" integrity="sha256-sYOADiz7tiw7zisrpWzbLdM692x1z0VQFz1d/r18aKY=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://lopeztel.xyz/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://lopeztel.xyz/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://lopeztel.xyz/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://lopeztel.xyz/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://lopeztel.xyz/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:title" content="Thank you Yunohost (Part 2)" />
<meta property="og:description" content="This is a bit of a continuation on my previous thank you post, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:
First things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a yunohost server on my raspberry pi 4 for months now." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://lopeztel.xyz/blog/2020/12/12/thank-you-yunohost-part-2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-12T09:52:12&#43;00:00" />
<meta property="article:modified_time" content="2020-12-12T09:52:12&#43;00:00" /><meta property="og:site_name" content="Lopeztel&#39;s blog" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Thank you Yunohost (Part 2)"/>
<meta name="twitter:description" content="This is a bit of a continuation on my previous thank you post, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:
First things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a yunohost server on my raspberry pi 4 for months now."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://lopeztel.xyz/blog/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Thank you Yunohost (Part 2)",
      "item": "https://lopeztel.xyz/blog/2020/12/12/thank-you-yunohost-part-2/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Thank you Yunohost (Part 2)",
  "name": "Thank you Yunohost (Part 2)",
  "description": "This is a bit of a continuation on my previous thank you post, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:\nFirst things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a yunohost server on my raspberry pi 4 for months now.",
  "keywords": [
    "100DaysToOffload", "Selfhosting", "yunohost"
  ],
  "articleBody": "This is a bit of a continuation on my previous thank you post, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:\nFirst things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a yunohost server on my raspberry pi 4 for months now.\nThe problem was that my SSL certificate from Let‚Äôs Encrypt expired at the beginning of November and I wasn‚Äôt able to renew it. Yunohost provides a way to renew or install SSL certificates via CLI or admin webpage, both methods were failing: SSL Certificates Expired: Challenge did not pass for xmpp-upload.maindomain.tld\nThe problem is very well documented here if it is of any interest üòõ\nYesterday I was thinking of using the nuclear option: nuking the whole server installation and starting over from scratch (as humanity should), I voiced my opinion on Mastodon but then @yunohost offered some help and after some intensive debugging copy-pasting commands prompted by some hero (Aleks, if you‚Äôre reading this you‚Äôre awesome) on the yunohost support matrix room we were able to find the problem:\nTurns out that my ‚Äúblog optimization‚Äù (documented here), in particular this code block added to nginx.conf:\n1 2 3 4 5 6 7 8 9 gzip on; add_header Content-Encoding \"gzip2\"; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_buffers 16 8k; gzip_http_version 1.1; gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript kind of broke the whole setup to automatically renew the SSL certificate. This is quite funny because they provide a way to regenerate nginx.conf, I incorrectly assumed yunohost tools regen-conf nginx --force would fix this but then again, I didn‚Äôt really check so‚Ä¶ *facepalm*\nThe problem was solved by adding gzip off; to /etc/nginx/conf.d/acme-challenge.conf.inc:\n1 2 3 4 5 { default_type \"text/plain\"; alias /tmp/acme-challenge-public/; gzip off; } this fix will be part of a future release of yunohost, 4.1 if I‚Äôm not mistaken (see this commit to their github repo) to prevent others from running into the same problem üòÄ\nThis has been a bit frustrating but a learning experience, I can‚Äôt thank you enough @yunohost!\nDay 36 of #100DaysToOffload\n",
  "wordCount" : "391",
  "inLanguage": "en",
  "datePublished": "2020-12-12T09:52:12Z",
  "dateModified": "2020-12-12T09:52:12Z",
  "author":{
    "@type": "Person",
    "name": "lopeztel"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://lopeztel.xyz/blog/2020/12/12/thank-you-yunohost-part-2/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Lopeztel's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://lopeztel.xyz/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://lopeztel.xyz/blog" accesskey="h" title="Lopeztel&#39;s Blog (Alt + H)">Lopeztel&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://lopeztel.xyz/blog/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="https://lopeztel.xyz/blog/posts/" title="posts">
                    <span>posts</span>
                </a>
            </li>
            <li>
                <a href="https://lopeztel.xyz/blog/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
            <li>
                <a href="https://lopeztel.xyz/blog/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://lopeztel.xyz/blog">Home</a>&nbsp;¬ª&nbsp;<a href="https://lopeztel.xyz/blog/posts/">Posts</a></div>
    <h1 class="post-title">
      Thank you Yunohost (Part 2)
    </h1>
    <div class="post-meta"><span title='2020-12-12 09:52:12 +0000 +0000'>December 12, 2020</span>&nbsp;¬∑&nbsp;2 min&nbsp;¬∑&nbsp;lopeztel

</div>
  </header> 

  <div class="post-content"><p>This is a bit of a continuation on my previous <a href="https://lopeztel.xyz/blog/2020/08/06/thank-you-yunohost/">thank you post</a>, since I received a lot of help and it deserves proper credit, this post is to be taken as part thank you note and part summary of the whole SSL certificate issue ordeal:</p>
<p>First things first, in short Yunohost is an easy solution to get started with self hosting without dealing with the more technical side of things, it‚Äôs easy to install apps and I‚Äôve been running a <a href="https://lopeztel.xyz/blog/2020/08/08/my-raspberry-pi-server-with-yunohost/">yunohost server on my raspberry pi 4</a> for months now.</p>
<p>The problem was that my SSL certificate from <!-- raw HTML omitted -->Let‚Äôs Encrypt<!-- raw HTML omitted --> expired at the beginning of November and I wasn‚Äôt able to renew it. Yunohost provides a way to renew or install SSL certificates via CLI or admin webpage, both methods were failing: <strong>SSL Certificates Expired: Challenge did not pass for xmpp-upload.maindomain.tld</strong></p>
<p>The problem is very well documented <a href="https://forum.yunohost.org/t/ssl-certificates-expired-challenge-did-not-pass-for-xmpp-upload-maindomain-tld/13508">here</a> if it is of any interest üòõ</p>
<p>Yesterday I was thinking of using the nuclear option: nuking the whole server installation and starting over from scratch (as humanity should), I voiced my opinion on Mastodon but then <a href="https://mastodon.social/@yunohost">@yunohost</a> offered some help and after some intensive <del>debugging</del> copy-pasting commands prompted by some hero (Aleks, if you‚Äôre reading this you‚Äôre awesome) on the <a href="https://app.element.io/#/room/#freenode_#yunohost:matrix.org">yunohost support matrix room</a> we were able to find the problem:</p>
<p>Turns out that my ‚Äúblog optimization‚Äù (documented <a href="https://lopeztel.xyz/blog/2020/08/22/optimizing-my-yunohost-wordpress-blog/">here</a>), in particular this code block added to <code>nginx.conf</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-0-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-1">1</a>
</span><span class="lnt" id="hl-0-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-2">2</a>
</span><span class="lnt" id="hl-0-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-3">3</a>
</span><span class="lnt" id="hl-0-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-4">4</a>
</span><span class="lnt" id="hl-0-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-5">5</a>
</span><span class="lnt" id="hl-0-6"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-6">6</a>
</span><span class="lnt" id="hl-0-7"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-7">7</a>
</span><span class="lnt" id="hl-0-8"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-8">8</a>
</span><span class="lnt" id="hl-0-9"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-0-9">9</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">gzip on;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">add_header Content-Encoding &#34;gzip2&#34;;
</span></span><span class="line"><span class="cl">gzip_vary on;
</span></span><span class="line"><span class="cl">gzip_proxied any;
</span></span><span class="line"><span class="cl">gzip_comp_level 6;
</span></span><span class="line"><span class="cl">gzip_buffers 16 8k;
</span></span><span class="line"><span class="cl">gzip_http_version 1.1;
</span></span><span class="line"><span class="cl">gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript
</span></span></code></pre></td></tr></table>
</div>
</div><p>kind of broke the whole setup to automatically renew the SSL certificate. This is quite funny because they provide a way to regenerate <code>nginx.conf</code>, I incorrectly assumed <code>yunohost tools regen-conf nginx --force</code> would fix this but then again, I didn‚Äôt really check so‚Ä¶ *facepalm*</p>
<p>The problem was solved by adding <code>gzip off;</code> to <code>/etc/nginx/conf.d/acme-challenge.conf.inc</code>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt" id="hl-1-1"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-1">1</a>
</span><span class="lnt" id="hl-1-2"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-2">2</a>
</span><span class="lnt" id="hl-1-3"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-3">3</a>
</span><span class="lnt" id="hl-1-4"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-4">4</a>
</span><span class="lnt" id="hl-1-5"><a style="outline: none; text-decoration:none; color:inherit" href="#hl-1-5">5</a>
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">        default_type &#34;text/plain&#34;;
</span></span><span class="line"><span class="cl">        alias /tmp/acme-challenge-public/;
</span></span><span class="line"><span class="cl">        gzip off;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>this fix will be part of a future release of yunohost, 4.1 if I‚Äôm not mistaken (see this <a href="https://github.com/YunoHost/yunohost/commit/c5d06af20e97e5939bb338ca81e6739e32ae943d">commit</a> to their github repo) to prevent others from running into the same problem üòÄ</p>
<p>This has been a bit frustrating but a learning experience, I can‚Äôt thank you enough <a href="https://mastodon.social/@yunohost">@yunohost</a>!</p>
<p>Day 36 of <a href="https://lopeztel.xyz/blog/tags/100daystooffload/">#100DaysToOffload</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://lopeztel.xyz/blog/tags/100daystooffload/">100DaysToOffload</a></li>
      <li><a href="https://lopeztel.xyz/blog/tags/selfhosting/">Selfhosting</a></li>
      <li><a href="https://lopeztel.xyz/blog/tags/yunohost/">yunohost</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://lopeztel.xyz/blog/2020/12/15/a-little-more-than-a-year-living-in-norway/">
    <span class="title">¬´ Prev</span>
    <br>
    <span>A little more than a year living in Norway</span>
  </a>
  <a class="next" href="https://lopeztel.xyz/blog/2020/12/06/thoughts-on-the-pinebookpro-part-4/">
    <span class="title">Next ¬ª</span>
    <br>
    <span>Thoughts on the pinebookpro (Part 4)</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://lopeztel.xyz/blog">Lopeztel&#39;s Blog</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
